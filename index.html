<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rifa Solidária - Loja Fraternidade de Aracati Nº4789</title>
<style>
:root {
  --primary: #4a90e2;
  --secondary: #f2f6fc;
  --success: #a8e6cf;
  --success-border: #56c596;
  --card-bg: #ffffff;
  --text-light: #555;
  --text-dark: #222;
  --btn-bg: #4a90e2;
  --btn-hover: #357ab7;
}

body {
  margin: 0;
  padding: 20px;
  font-family: 'Segoe UI', Roboto, Arial, sans-serif;
  background: var(--secondary);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
}

.container {
  max-width: 700px;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

header {
  text-align: center;
}

header h1 {
  font-size: 26px;
  margin-bottom: 15px;
  color: var(--primary);
}

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

select, button {
  padding: 10px 16px;
  border-radius: 8px;
  border: 1px solid #cfd5e6;
  font-size: 16px;
  cursor: pointer;
}

button {
  background: var(--btn-bg);
  color: #fff;
  border: none;
  transition: 0.2s;
}

button:hover { background: var(--btn-hover); }

.card {
  background: var(--card-bg);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  padding: 20px;
}

.numbers {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  margin-top: 15px;
  max-height: 500px;
  overflow-y: auto;
  padding-right: 6px;
}

.num {
  padding: 15px 0;
  font-size: 18px;
  text-align: center;
  border-radius: 8px;
  border: 1px solid #d9dce6;
  background: #f9faff;
  cursor: pointer;
  user-select: none;
  transition: 0.2s;
}

.num:hover { background: #e1eaff; }
.num.sold { background: var(--success); border-color: var(--success-border); text-decoration: line-through; }

.meta {
  font-size: 14px;
  color: var(--text-light);
  margin-top: 10px;
}

.footer-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 15px;
}

.export-area {
  white-space: pre-wrap;
  background: #f0f4ff;
  padding: 10px;
  border-radius: 8px;
  margin-top: 12px;
  font-family: monospace;
  font-size: 14px;
  border: 1px solid #cfd5e6;
}

@media(max-width:600px){
  .numbers { grid-template-columns: repeat(3, 1fr); }
  select, button { font-size: 14px; padding: 8px 12px; }
  .num { font-size: 20px; padding: 18px 0; }
}
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>Rifa Solidária — Loja Fraternidade de Aracati Nº4789</h1>
    <div class="controls">
      <label>Irmão:</label>
      <select id="brotherSelect"></select>
      <button id="btnExport">Exportar CSV</button>
    </div>
  </header>

  <section class="card">
    <strong>Atribuição de números (25 cada)</strong>
    <div id="assignmentList" class="meta"></div>

    <div class="meta" style="margin-top:10px;">Números do irmão selecionado:</div>
    <div id="numbers" class="numbers"></div>

    <div class="meta" id="summary"></div>

    <div class="footer-actions">
      <button id="btnMarkAll">Marcar todos</button>
      <button id="btnUnmarkAll">Desmarcar todos</button>
    </div>

    <div id="exportArea" class="export-area"></div>
  </section>

  <section class="card">
    <strong>Resumo geral</strong>
    <div id="totals" style="margin-top:8px;"></div>
  </section>
</div>

<script>
const brothers = [
  'Renato Carlos VM','Cicero Pessoa MI','Robson Porto MM','José Amauri MI','Moesio Carvalho AP',
  'Yuri Emmanuel CM','Renê Carlos AP','Luis Gabriel AP','Francisco Josemar MM','José Hildo MM',
  'Georgiano MM','Rafael Barbosa MI','Neidio Bezerra MI','Julio Dantas AP','Rogério Carvalho AP',
  'Alexandre Castelo MI','Geremias Andrade MM','Ikaro Pessoa MM','João Filho MI','Marcus Vinicius MM'
];

const TOTAL=500, PER=25;
const assignments = brothers.map((b,i)=>{
  const start=i*PER+1, end=start+PER-1;
  const nums=Array.from({length:PER},(_,j)=>start+j);
  return {name:b,start,end,nums};
});

const sel=document.getElementById('brotherSelect'),
      numbersDiv=document.getElementById('numbers'),
      summary=document.getElementById('summary'),
      totals=document.getElementById('totals'),
      exportArea=document.getElementById('exportArea'),
      assignmentList=document.getElementById('assignmentList');

const KEY='rifa_fraternidade_4789_vendas_v1';

function loadStorage(){return JSON.parse(localStorage.getItem(KEY)||'{}');}
function saveStorage(obj){localStorage.setItem(KEY,JSON.stringify(obj));}

function init(){
  brothers.forEach((b,i)=>{
    const opt=document.createElement('option');opt.value=i;opt.textContent=b;sel.appendChild(opt);
  });
  assignmentList.innerHTML=assignments.map(a=>`<div>${a.name}: ${a.start} — ${a.end}</div>`).join('');
  sel.addEventListener('change',renderForSelected);
  document.getElementById('btnMarkAll').addEventListener('click',markAll);
  document.getElementById('btnUnmarkAll').addEventListener('click',unmarkAll);
  document.getElementById('btnExport').addEventListener('click',exportCSV);
  sel.selectedIndex=0;renderForSelected();renderTotals();
}

function renderForSelected(){
  const idx=+sel.value, assign=assignments[idx], store=loadStorage(), sold=store[assign.name]||[];
  numbersDiv.innerHTML='';
  assign.nums.forEach(n=>{
    const el=document.createElement('div');
    el.className='num'+(sold.includes(n)?' sold':'');
    el.textContent=n; el.dataset.num=n;
    el.onclick=()=>toggleNumber(assign.name,n,el);
    numbersDiv.appendChild(el);
  });
  summary.innerHTML=`Vendidos por <strong>${assign.name}</strong>: ${sold.length} / ${PER}`;
  exportArea.textContent=`Irmão: ${assign.name}\nNúmeros: ${assign.start} — ${assign.end}\nVendidos: ${sold.length}\nLista: ${sold.join(', ')}`;
}

function toggleNumber(name,num,el){
  const store=loadStorage();
  if(!store[name]) store[name]=[];
  const arr=store[name], idx=arr.indexOf(num);
  if(idx===-1) arr.push(num); else arr.splice(idx,1);
  arr.sort((a,b)=>a-b);
  saveStorage(store);
  el.classList.toggle('sold');
  renderTotals(); renderForSelected();
}

function renderTotals(){
  const store=loadStorage();
  const perBrother=assignments.map(a=>({name:a.name,sold:(store[a.name]||[]).length}));
  const totalSold=perBrother.reduce((s,p)=>s+p.sold,0);
  let html=`<div>Total vendidos: <strong>${totalSold}</strong> / ${TOTAL}</div>`;
  perBrother.forEach(p=> html+=`<div class="meta">${p.name}: ${p.sold}</div>`);
  totals.innerHTML=html;
}

function markAll(){const idx=+sel.value,name=assignments[idx].name,store=loadStorage();store[name]=assignments[idx].nums.slice();saveStorage(store);renderForSelected();renderTotals();}
function unmarkAll(){const idx=+sel.value,name=assignments[idx].name,store=loadStorage();store[name]=[];saveStorage(store);renderForSelected();renderTotals();}

function exportCSV(){
  const senha = prompt("Digite a senha para exportar CSV:");
  if(senha!=='12345610'){ alert("Senha incorreta!"); return; }
  const store=loadStorage();let rows=['Nome;Numero_Vendido'];
  Object.keys(store).forEach(name=>(store[name]||[]).forEach(num=>rows.push(`${name};${num}`)));
  const csv=rows.join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='rifa_vendas.csv';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
  exportArea.textContent=csv;
}

init();
</script>
</body>
</html>
